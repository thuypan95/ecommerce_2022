{"ast":null,"code":"var _jsxFileName = \"/Users/vnng-it/Documents/projects/react-hook/client-project-shop/src/components/Products/ProductDetail.js\",\n    _s = $RefreshSig$();\n\nimport axios from \"axios\";\nimport React from 'react';\nimport { useEffect, useRef, useState } from \"react\";\nimport { domainProduct, baseURL, domainComments } from \"../../api\";\nimport LoadingList from '../UI/LoadingList';\nimport { useDispatch } from \"react-redux\";\nimport { cartActions } from \"../../redux/cart-slice\";\nimport TabProduct from \"./TabProductDetail\";\nimport RelatedProduct from \"./RelatedProduct\";\nimport { fetchProductDataByCategory } from \"../../redux/product-actions\";\nimport { useSelector } from \"react-redux\";\nimport { authHeader, Toast } from \"../../functions\";\nimport { socket } from \"../../socket\";\nimport ProductInfo from \"./ProductInfo\";\nimport ProductComments from \"./ProductComments\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst ProductDetail = props => {\n  _s();\n\n  const user = useSelector(state => state.auth);\n  const dispatch = useDispatch();\n  const [isLoading, setIsLoading] = useState(false);\n  const [detail, setDetail] = useState({});\n  const [images, setImages] = useState([]);\n  const [imgIndex, setImageIndex] = useState(0);\n  const [isOpenLightBox, setIsOpenLightBox] = useState(false);\n  const [selectColor, setSelectColor] = useState({});\n  const [selectSize, setSelectSize] = useState({});\n  const [errors, setErrors] = useState({});\n  const [contentComment, setContentComment] = useState('');\n  const [listComment, setListComment] = useState([]);\n  const [isErrorComment, setIsErrorComment] = useState(false);\n  const [isLoadingComment, setIsLoadingComment] = useState(false);\n  const [showReplies, setShowReplies] = useState(-1);\n  const [contentReply, setContentReply] = useState('');\n  const [isErrorReply, setIsErrorReply] = useState(false);\n  const inputRef = useRef();\n  const listProductRelated = useSelector(state => state.product.list);\n  const isLoadingRelated = useSelector(state => state.ui.isLoading);\n  const settings = {\n    customPaging: function (i) {\n      return /*#__PURE__*/_jsxDEV(\"span\", {\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: images[i],\n          alt: \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 23\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 17\n      }, this);\n    },\n    dots: true,\n    dotsClass: \"slick-dots slick-thumb\",\n    infinite: true,\n    speed: 500,\n    slidesToShow: 1,\n    slidesToScroll: 1,\n    swipeToSlide: true,\n    responsive: [{\n      breakpoint: 768,\n      settings: {\n        customPaging: function (i) {\n          return /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 60,\n            columnNumber: 25\n          }, this);\n        },\n        dotsClass: \"hidden\"\n      }\n    }]\n  };\n\n  const fetchProductDetail = async () => {\n    setIsLoading(true);\n    await axios.get(`${baseURL + domainProduct}/${props.id}`).then(response => {\n      const data = response.data;\n      props.setNameProduct(data.name);\n      let arrImage = [];\n      data.images.map(img => {\n        return arrImage.push(img.url);\n      });\n      setImages(arrImage);\n      setDetail(data);\n      setIsLoading(false);\n      dispatch(fetchProductDataByCategory(data.categories[0].id));\n    }).catch(error => {\n      setIsLoading(false);\n      console.log(error);\n    });\n  };\n\n  useEffect(() => {\n    fetchProductDetail();\n    getListComment(); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.id]);\n\n  const handleSelectColor = color => {\n    setSelectColor({\n      id: color.id,\n      name: color.name,\n      code: color.color_code\n    });\n  };\n\n  const handleSelectSize = size => {\n    setSelectSize({\n      id: size.id,\n      name: size.name\n    });\n  };\n\n  const handleAddToCart = () => {\n    let errorsAddToCart = {\n      errColor: '',\n      errSize: '',\n      errQty: ''\n    };\n    const enterQuantity = Number(inputRef.current.value);\n    if (enterQuantity <= 0) errorsAddToCart.errQty = 'Quantity must be large than 0';else errorsAddToCart.errQty = '';\n    if (selectSize.id === undefined) errorsAddToCart.errSize = 'You must be select one size';else errorsAddToCart.errSize = '';\n    if (selectColor.id === undefined) errorsAddToCart.errColor = 'You must be select one color';else errorsAddToCart.errColor = '';\n    setErrors(errorsAddToCart);\n\n    if (errorsAddToCart.errColor === '' && errorsAddToCart.errSize === '' && errorsAddToCart.errQty === '') {\n      dispatch(cartActions.addItem({ ...detail,\n        quantity: enterQuantity,\n        color: selectColor.name,\n        size: selectSize.name,\n        colorId: selectColor.id,\n        sizeId: selectSize.id\n      }));\n      Toast.success('Add to cart success');\n    }\n  };\n\n  const getListComment = async () => {\n    setIsLoadingComment(true);\n    await axios.get(`${baseURL + domainComments}?product=${props.id}&_sort=created_at:ASC`).then(response => {\n      const data = response.data;\n      setListComment(data);\n      setIsLoadingComment(false);\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const handleComment = () => {\n    if (contentComment !== '' && !isErrorComment) {\n      setIsErrorComment(false);\n\n      if (user.id) {\n        setIsLoadingComment(true);\n        setContentComment('');\n        socket.emit('addComment', {\n          comment_content: contentComment,\n          users_permissions_user: user.id,\n          product: detail\n        }, response => {\n          if (response.err) {\n            setIsErrorComment(false);\n            Toast.error(response.err);\n          } else {\n            setIsLoadingComment(false);\n            Toast.success('Comment added successfully!');\n            getListComment();\n          }\n        });\n      } else {\n        Toast.error('You must login!');\n      }\n    } else {\n      setIsErrorComment(true);\n    }\n  };\n\n  const handleReply = (comment, reply) => {\n    console.log(\"comment\", comment, \"reply\", reply);\n\n    if (contentReply !== '' && !isErrorReply) {\n      if (user.id) {\n        var _reply$users_permissi;\n\n        setIsErrorComment(false);\n        setContentReply('');\n        socket.emit('addComment', {\n          comment_content: contentReply,\n          users_permissions_user: user.id,\n          product: detail,\n          parent_id: comment.id,\n          name_reply_to: reply === null || reply === void 0 ? void 0 : (_reply$users_permissi = reply.users_permissions_user) === null || _reply$users_permissi === void 0 ? void 0 : _reply$users_permissi.username\n        }, response => {\n          if (response) {\n            const data = {\n              count_reply: comment.count_reply + 1\n            };\n            setIsLoadingComment(false);\n            Toast.success('Comment added successfully!');\n            axios.put(`${baseURL + domainComments}/${comment.id}`, data.count_reply, authHeader()).then(() => {\n              setShowReplies(comment.id);\n              getListComment();\n            });\n          }\n        });\n      } else {\n        Toast.error('You must login!');\n      }\n    } else {\n      setIsErrorReply(true);\n    }\n  };\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(LoadingList, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(ProductInfo, {\n      settings: settings,\n      images: images,\n      setIsOpenLightBox: setIsOpenLightBox,\n      isOpenLightBox: isOpenLightBox,\n      setImageIndex: setImageIndex,\n      imgIndex: imgIndex,\n      detail: detail,\n      selectColor: selectColor,\n      selectSize: selectSize,\n      handleSelectColor: handleSelectColor,\n      handleSelectSize: handleSelectSize,\n      errors: errors,\n      handleAddToCart: handleAddToCart,\n      inputRef: inputRef\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(TabProduct, {\n      handleReply: handleReply,\n      setContentReply: setContentReply,\n      setIsErrorReply: setIsErrorReply,\n      isErrorReply: isErrorReply,\n      setIsErrorComment: setIsErrorComment,\n      isErrorComment: isErrorComment,\n      listComment: listComment,\n      handleComment: handleComment,\n      getListComment: getListComment,\n      setContentComment: setContentComment,\n      contentComment: contentComment,\n      detail: detail,\n      isLoadingComment: isLoadingComment\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ProductComments, {\n      showReplies: showReplies,\n      setShowReplies: setShowReplies,\n      handleReply: handleReply,\n      setContentReply: setContentReply,\n      contentComment: contentComment,\n      setIsErrorReply: setIsErrorReply,\n      isErrorReply: isErrorReply,\n      setIsErrorComment: setIsErrorComment,\n      isErrorComment: isErrorComment,\n      isLoadingComment: isLoadingComment,\n      listComment: listComment,\n      handleComment: handleComment,\n      setContentComment: setContentComment\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(RelatedProduct, {\n      listProductRelated: listProductRelated,\n      isLoadingRelated: isLoadingRelated\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(ProductDetail, \"uFC56FKJaenWdKnY+LLLXOCkT9U=\", false, function () {\n  return [useSelector, useDispatch, useSelector, useSelector];\n});\n\n_c = ProductDetail;\nexport default ProductDetail;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProductDetail\");","map":{"version":3,"sources":["/Users/vnng-it/Documents/projects/react-hook/client-project-shop/src/components/Products/ProductDetail.js"],"names":["axios","React","useEffect","useRef","useState","domainProduct","baseURL","domainComments","LoadingList","useDispatch","cartActions","TabProduct","RelatedProduct","fetchProductDataByCategory","useSelector","authHeader","Toast","socket","ProductInfo","ProductComments","ProductDetail","props","user","state","auth","dispatch","isLoading","setIsLoading","detail","setDetail","images","setImages","imgIndex","setImageIndex","isOpenLightBox","setIsOpenLightBox","selectColor","setSelectColor","selectSize","setSelectSize","errors","setErrors","contentComment","setContentComment","listComment","setListComment","isErrorComment","setIsErrorComment","isLoadingComment","setIsLoadingComment","showReplies","setShowReplies","contentReply","setContentReply","isErrorReply","setIsErrorReply","inputRef","listProductRelated","product","list","isLoadingRelated","ui","settings","customPaging","i","dots","dotsClass","infinite","speed","slidesToShow","slidesToScroll","swipeToSlide","responsive","breakpoint","fetchProductDetail","get","id","then","response","data","setNameProduct","name","arrImage","map","img","push","url","categories","catch","error","console","log","getListComment","handleSelectColor","color","code","color_code","handleSelectSize","size","handleAddToCart","errorsAddToCart","errColor","errSize","errQty","enterQuantity","Number","current","value","undefined","addItem","quantity","colorId","sizeId","success","err","handleComment","emit","comment_content","users_permissions_user","handleReply","comment","reply","parent_id","name_reply_to","username","count_reply","put"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport React from 'react';\nimport { useEffect, useRef, useState } from \"react\";\nimport { domainProduct, baseURL, domainComments } from \"../../api\";\nimport LoadingList from '../UI/LoadingList';\nimport { useDispatch } from \"react-redux\";\nimport { cartActions } from \"../../redux/cart-slice\";\nimport TabProduct from \"./TabProductDetail\";\nimport RelatedProduct from \"./RelatedProduct\";\nimport { fetchProductDataByCategory } from \"../../redux/product-actions\";\nimport { useSelector } from \"react-redux\";\nimport { authHeader, Toast } from \"../../functions\";\nimport { socket } from \"../../socket\";\nimport ProductInfo from \"./ProductInfo\";\nimport ProductComments from \"./ProductComments\";\n\nconst ProductDetail = (props) => {\n    const user = useSelector(state => state.auth);\n    const dispatch = useDispatch();\n    const [isLoading, setIsLoading] = useState(false);\n    const [detail, setDetail] = useState({});\n    const [images, setImages] = useState([]);\n    const [imgIndex, setImageIndex] = useState(0);\n    const [isOpenLightBox, setIsOpenLightBox] = useState(false);\n    const [selectColor, setSelectColor] = useState({});\n    const [selectSize, setSelectSize] = useState({});\n    const [errors, setErrors] = useState({});\n    const [contentComment, setContentComment] = useState('');\n    const [listComment, setListComment] = useState([]);\n    const [isErrorComment, setIsErrorComment] = useState(false);\n    const [isLoadingComment, setIsLoadingComment] = useState(false);\n    const [showReplies, setShowReplies] = useState(-1);\n    const [contentReply, setContentReply] = useState('');\n\n\n    const [isErrorReply, setIsErrorReply] = useState(false);\n\n    const inputRef = useRef();\n    const listProductRelated = useSelector((state) => state.product.list);\n    const isLoadingRelated = useSelector(state => state.ui.isLoading);\n\n    const settings = {\n        customPaging: function (i) {\n            return (\n                <span><img src={images[i]} alt=\"\" /></span>\n            );\n        },\n        dots: true,\n        dotsClass: \"slick-dots slick-thumb\",\n        infinite: true,\n        speed: 500,\n        slidesToShow: 1,\n        slidesToScroll: 1,\n        swipeToSlide: true,\n        responsive: [{\n            breakpoint: 768,\n            settings: {\n                customPaging: function (i) {\n                    return (\n                        <span />\n                    );\n                },\n                dotsClass: \"hidden\",\n            }\n        }]\n    };\n    const fetchProductDetail = async () => {\n        setIsLoading(true);\n        await axios.get(`${baseURL + domainProduct}/${props.id}`)\n            .then(response => {\n                const data = response.data;\n                props.setNameProduct(data.name);\n                let arrImage = [];\n                data.images.map(img => {\n                    return arrImage.push(img.url)\n                });\n                setImages(arrImage);\n                setDetail(data);\n                setIsLoading(false);\n                dispatch(fetchProductDataByCategory(data.categories[0].id));\n            })\n            .catch(error => {\n                setIsLoading(false);\n                console.log(error)\n            })\n    }\n\n    useEffect(() => {\n        fetchProductDetail();\n        getListComment();\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [props.id]);\n\n    const handleSelectColor = (color) => {\n        setSelectColor({ id: color.id, name: color.name, code: color.color_code });\n    }\n    const handleSelectSize = (size) => {\n        setSelectSize({ id: size.id, name: size.name });\n    }\n    const handleAddToCart = () => {\n        let errorsAddToCart = {\n            errColor: '', errSize: '', errQty: ''\n        }\n        const enterQuantity = Number(inputRef.current.value);\n        if (enterQuantity <= 0) errorsAddToCart.errQty = 'Quantity must be large than 0';\n        else errorsAddToCart.errQty = '';\n\n        if (selectSize.id === undefined) errorsAddToCart.errSize = 'You must be select one size';\n        else errorsAddToCart.errSize = '';\n\n        if (selectColor.id === undefined) errorsAddToCart.errColor = 'You must be select one color';\n        else errorsAddToCart.errColor = '';\n\n        setErrors(errorsAddToCart);\n\n        if (errorsAddToCart.errColor === '' && errorsAddToCart.errSize === '' && errorsAddToCart.errQty === '') {\n            dispatch(cartActions.addItem({ ...detail, quantity: enterQuantity, color: selectColor.name, size: selectSize.name, colorId: selectColor.id, sizeId: selectSize.id }));\n            Toast.success('Add to cart success');\n        }\n    }\n    const getListComment = async () => {\n        setIsLoadingComment(true);\n        await axios.get(`${baseURL + domainComments}?product=${props.id}&_sort=created_at:ASC`)\n            .then((response) => {\n                const data = response.data;\n                setListComment(data);\n                setIsLoadingComment(false);\n            })\n            .catch(err => {\n                console.log(err);\n            })\n    }\n    const handleComment = () => {\n        if (contentComment !== '' && !isErrorComment) {\n            setIsErrorComment(false);\n            if (user.id) {\n                setIsLoadingComment(true);\n                setContentComment('');\n                socket.emit('addComment', { comment_content: contentComment, users_permissions_user: user.id, product: detail },\n                    (response) => {\n                        if (response.err) {\n                            setIsErrorComment(false);\n                            Toast.error(response.err);\n                        }\n                        else {\n                            setIsLoadingComment(false)\n                            Toast.success('Comment added successfully!');\n                            getListComment();\n                        }\n                    })\n            }\n            else { Toast.error('You must login!'); }\n        }\n        else { setIsErrorComment(true); }\n    }\n    const handleReply = (comment, reply) => {\n        console.log(\"comment\", comment, \"reply\", reply);\n        if (contentReply !== '' && !isErrorReply) {\n            if (user.id) {\n                setIsErrorComment(false);\n                setContentReply('');\n                socket.emit('addComment', {\n                    comment_content: contentReply, users_permissions_user: user.id,\n                    product: detail, parent_id: comment.id, name_reply_to: reply?.users_permissions_user?.username\n                },\n                    (response) => {\n                        if (response) {\n                            const data = {\n                                count_reply: comment.count_reply + 1\n                            }\n                            setIsLoadingComment(false)\n                            Toast.success('Comment added successfully!');\n                            axios.put(`${baseURL + domainComments}/${comment.id}`, data.count_reply, authHeader()).then(() => {\n                                setShowReplies(comment.id);\n                                getListComment();\n                            })\n                        }\n                    })\n\n            }\n            else { Toast.error('You must login!'); }\n        }\n        else { setIsErrorReply(true); }\n    }\n    if (isLoading) {\n        return <LoadingList />\n    }\n    return <>\n        <ProductInfo settings={settings}\n            images={images}\n            setIsOpenLightBox={setIsOpenLightBox}\n            isOpenLightBox={isOpenLightBox}\n            setImageIndex={setImageIndex}\n            imgIndex={imgIndex}\n            detail={detail}\n            selectColor={selectColor}\n            selectSize={selectSize}\n            handleSelectColor={handleSelectColor}\n            handleSelectSize={handleSelectSize}\n            errors={errors}\n            handleAddToCart={handleAddToCart}\n            inputRef={inputRef} />\n        <TabProduct\n            handleReply={handleReply}\n            setContentReply={setContentReply}\n            setIsErrorReply={setIsErrorReply}\n            isErrorReply={isErrorReply}\n            setIsErrorComment={setIsErrorComment}\n            isErrorComment={isErrorComment}\n            listComment={listComment}\n            handleComment={handleComment}\n            getListComment={getListComment}\n            setContentComment={setContentComment}\n            contentComment={contentComment}\n            detail={detail}\n            isLoadingComment={isLoadingComment} />\n        <ProductComments\n            showReplies={showReplies}\n            setShowReplies={setShowReplies}\n            handleReply={handleReply}\n            setContentReply={setContentReply}\n            contentComment={contentComment}\n            setIsErrorReply={setIsErrorReply}\n            isErrorReply={isErrorReply}\n            setIsErrorComment={setIsErrorComment}\n            isErrorComment={isErrorComment}\n            isLoadingComment={isLoadingComment}\n            listComment={listComment}\n            handleComment={handleComment}\n            setContentComment={setContentComment} />\n        <RelatedProduct listProductRelated={listProductRelated}\n            isLoadingRelated={isLoadingRelated} />\n    </>\n}\nexport default ProductDetail;"]},"metadata":{},"sourceType":"module"}